import numpy as np
import matplotlib.pyplot as plt
import matplotlib.animation as animation
from matplotlib.patches import Rectangle
import DelanayTriangles_copy_2 as DT

#Points from racetrack 1A:
yellow_points=[[1.8369701987210297e-16, 3.0], [3.6739403974420594e-16, 6.0], [5.51091059616309e-16, 9.0], [7.347880794884119e-16, 12.0], [0.37305093947226275, 14.968847511054276], [1.4690092573155287, 17.75310646325044], [3.2197335735141515, 20.17966512028001], [5.516372329582325, 22.09765181769476], [8.216131651256777, 23.387815432267033], [11.151153579987566, 23.969939839248653], [15.0, 24.0], [18.87655323162522, 24.734504628657763], [21.048825908847377, 26.758186164791162], [21.984969919624326, 29.575576789993782], [21.45578456095409, 32.49688101928285], [19.59083286462374, 34.806861693281604], [15.233042997596288, 36.664216154692454], [12.413965135238563, 37.69027658466946], [9.594887272880838, 38.71633701464647], [6.775809410523113, 39.74239744462348], [4.323948943833934, 41.41644517267064], [2.974820187747273, 44.06104479140184], [3.058736914263447, 47.02870608051554], [4.555153382033143, 49.59284205563091], [7.269337941714822, 51.905182657112405], [9.567471271071756, 53.83354548617202], [11.865604600428691, 55.761908315231636], [14.163737929785626, 57.69027114429125], [16.737977979647624, 59.203632589121604], [19.66568783533057, 59.791416306103834], [23.72181219596864, 59.5001562108032], [26.710396290243875, 59.23868898256023], [29.69898038451911, 58.977221754317256], [32.68756447879435, 58.715754526074285], [37.60499049322057, 57.91105956262807], [40.28313543830076, 56.57660754008259], [42.54787462891757, 54.621056736391054], [44.25839755128446, 52.165993828970606], [45.30835217487179, 49.3640627385007], [45.632457406557485, 46.389473969254055], [45.21056195281351, 43.42717304371586], [44.06889722953622, 40.66134148576471], [41.74318018442071, 37.24673329439849], [40.02245087536757, 34.789277161531516], [37.82704581920054, 30.373344065372756], [38.23878426553027, 27.433186417268296], [40.009705410112815, 25.0503532624789], [42.56671592971565, 22.78615577396048], [44.21883147589923, 20.291413949764475], [45.202377746073836, 17.465487680068122], [45.45620259688893, 14.484079373169687], [44.964524428501534, 11.532558557375648], [43.75791340801747, 8.794436501553317], [41.57492963649537, 5.6244042885658665], [39.85420032744223, 3.1669481556988903], [38.13347101838909, 0.7094920228319141], [36.41274170933595, -1.747964110035062], [34.161147589661546, -3.6830040228380967], [31.257480301364154, -4.301689583332948], [28.41265886555597, -3.4525449888972157], [25.598914692628757, -1.5006884486096015], [23.14145855976178, 0.220040860443536], [18.725525463603024, 2.41544591661057], [15.785367815498564, 2.003707470280841], [13.402534660709168, 0.23278632569828828], [12.160426659738832, -2.463734257909158], [11.102109914278866, -5.82637485776384], [8.896803058722876, -7.81400591425569], [6.008543128864599, -8.501035841892204], [3.144476887119924, -7.719255753381572], [1.0058276372701513, -5.660072679924972], [0.11621130367865184, -2.8276464544249356], [0.10735947597657558, 0.4981503803835672]]
blue_points=[[3.0, 3.0], [3.0000000000000004, 6.0], [3.0000000000000004, 9.0], [3.000000000000001, 12.0], [3.4953874831673613, 14.944752271165372], [4.927014653007467, 17.56532822762763], [7.1372792471867434, 19.57323886327107], [9.882861840273096, 20.747441112269815], [15.0, 21.0], [18.94475227116537, 21.495387483167363], [21.56532822762763, 22.92701465300747], [23.57323886327107, 25.137279247186743], [24.747441112269815, 27.882861840273094], [24.958671619765884, 30.86151193212938], [24.183676841431136, 33.74532152892428], [22.507772935644923, 36.216823257748885], [20.115453639722308, 38.00393911391737], [16.259103427573294, 39.48329401705018], [13.440025565215569, 40.509354447027185], [10.620947702857844, 41.53541487700419], [7.801869840500119, 42.5614753069812], [5.901375229112199, 44.72079898037038], [6.6915418262551345, 47.48669761248492], [9.197700770774441, 49.60704932775547], [11.495834100131376, 51.535412156815084], [13.79396742948831, 53.4637749858747], [16.092100758845245, 55.392137814934316], [18.767798851826303, 56.67848740159834], [23.460344967725664, 56.51157211652796], [26.4489290620009, 56.25010488828499], [29.437513156276136, 55.988637660042016], [32.42609725055138, 55.727170431799046], [37.308857382420086, 54.80270449067011], [39.79468672686936, 53.14812685051918], [41.60231940396483, 50.771272037597456], [42.532760168729304, 47.93379874604439], [42.483580419231004, 44.94807336529489], [41.46019416265365, 42.14278278019303], [39.285724051553736, 38.96746260345163], [37.564994742500595, 36.510006470584656], [35.13459902571854, 32.17535995194885], [34.80421873025788, 29.207562189737985], [35.46307126409569, 26.295022398478817], [37.03862611645056, 23.758370746352828], [40.75607959688174, 20.242307873062916], [42.08158213857216, 17.566486931933873], [42.45861055118685, 14.604253944288613], [41.84565924441297, 11.681709608861572], [39.117473503628396, 7.345133597619004], [37.396744194575255, 4.887677464752028], [35.676014885522115, 2.4302213318850514], [33.955285576468974, -0.027234800981924545], [31.37765487248308, -1.304097537630867], [27.319644001681894, 0.9567676842573756], [24.862187868814917, 2.677496993310513], [20.52754135017912, 5.107892710092562], [17.55974358796825, 5.438273005553231], [14.647203796709084, 4.779420471715424], [12.110552144583098, 3.2038656193605504], [10.229038737727848, 0.8850551491330987], [9.209792063069488, -1.9217421205695746], [7.502081267349726, -5.15792776693606], [4.62591818154825, -5.110552686499002], [3.111785389827614, -2.6647480370206837], [3.1073594759765757, 0.4981503803835679]]

midpoints=[[1.6073594759765757, 0.4981503803835675], [1.5536797379882878, 1.7490751901917836], [1.5, 3.0], [1.5000000000000002, 4.5], [1.5000000000000004, 6.0], [1.5000000000000004, 7.5], [1.5000000000000004, 9.0], [1.5000000000000007, 10.5], [1.5000000000000009, 12.0], [1.6865254697361318, 13.48442375552714], [1.934219211319812, 14.956799891109824], [2.482198370241445, 16.348929367207905], [3.198011955161498, 17.659217345439036], [4.07337411326081, 18.87249667395382], [5.1785064103504475, 19.87645199177554], [6.326825788384534, 20.835445340482913], [7.67670544922176, 21.480527147769052], [9.049496745764937, 22.067628272268422], [10.517007710130331, 22.358690475759232], [13.075576789993782, 22.484969919624326], [15.0, 22.5], [16.972376135582685, 22.74769374158368], [18.910652751395297, 23.11494605591256], [20.220940729626427, 23.830759640832618], [21.307077068237504, 24.842600408899315], [22.311032386059225, 25.947732705988955], [22.898133510558594, 27.320524002532128], [23.366205515947073, 28.729219315133438], [23.471820769695107, 30.218544361061582], [23.207228090359987, 31.679196475706114], [22.81973070119261, 33.121101274103566], [21.981778748299504, 34.35685213851587], [21.04930290013433, 35.511842475515245], [19.853143252173023, 36.40540040359949], [17.6742483186593, 37.33407763430491], [15.74607321258479, 38.07375508587131], [14.336534281405928, 38.586785300859816], [12.926995350227067, 39.09981551584832], [11.517456419048203, 39.612845730836824], [10.10791748786934, 40.12587594582533], [8.698378556690479, 40.63890616081383], [7.288839625511616, 41.151936375802336], [6.062909392167027, 41.98896023982592], [5.112662086473067, 43.06862207652051], [4.438097708429736, 44.390921885886115], [4.480056071687823, 45.87475253044296], [4.875139370259291, 47.257701846500225], [5.623347604144138, 48.539769834057914], [6.980439883984978, 49.69594013479866], [8.233519356244631, 50.756115992433934], [9.3825860209231, 51.720297406963745], [10.531652685601566, 52.684478821493556], [11.680719350280032, 53.64866023602336], [12.8297860149585, 54.612841650553165], [13.978852679636969, 55.577023065082976], [15.127919344315435, 56.54120447961279], [16.415039369246436, 57.297885202027956], [17.75288841573696, 57.94105999535997], [19.216743343578436, 58.234951853851086], [21.563016401528117, 58.15149421131589], [23.59107858184715, 58.00586416366558], [25.08537062898477, 57.875130549544096], [26.57966267612239, 57.74439693542261], [28.073954723260005, 57.61366332130112], [29.56824677039762, 57.482929707179636], [31.062538817535245, 57.352196093058154], [32.55683086467286, 57.221462478936665], [35.015543871885974, 56.81911499721356], [37.45692393782033, 56.35688202664909], [38.795996410360424, 55.68965601537635], [40.03891108258506, 54.86236719530089], [41.17128067789346, 53.884591793455115], [42.0750970164412, 52.696164386994255], [42.930358477624644, 51.46863293328403], [43.455335789418314, 50.067667388049074], [43.92055617180055, 48.64893074227254], [44.082608787643395, 47.16163635764922], [44.05801891289424, 45.66877366727447], [43.847071186022255, 44.18762320450537], [43.33537805773358, 42.78497791195444], [42.764545696094935, 41.40206213297887], [41.60168717353718, 39.694758037295756], [40.51445211798722, 38.10709794892506], [39.654087463460655, 36.87836988249157], [38.79372280893408, 35.649641816058086], [37.578524950543056, 33.48231855674018], [36.48082242245954, 31.274352008660802], [36.31563227472921, 29.79045312755537], [36.52150149789408, 28.32037430350314], [36.85092776481298, 26.864104407873555], [37.638705190990414, 25.595778581810563], [38.52416576328169, 24.404362004415866], [40.382892503497274, 22.64633056777091], [41.661397763298694, 21.5142318235117], [42.487455536390485, 20.266860911413694], [43.15020680723569, 18.928950440849174], [43.641979942323, 17.515987306000998], [43.83049414863034, 16.03487081217837], [43.95740657403789, 14.54416665872915], [43.71156748984419, 13.06840625083213], [43.40509183645725, 11.60713408311861], [42.80178632621522, 10.238073055207444], [41.43769345582294, 8.06978504958616], [40.34620157006188, 6.484768943092435], [39.485836915535316, 5.256040876658947], [38.62547226100874, 4.027312810225459], [37.765107606482175, 2.798584743791971], [36.9047429519556, 1.5698566773584828], [36.044378297429034, 0.3411286109249947], [35.18401364290246, -0.8875994555084933], [34.05821658306526, -1.8551194119100107], [32.769401231072315, -2.493550780234482], [31.317567586923616, -2.802893560481907], [29.895156869019523, -2.3783212632640414], [27.86615143361893, -1.24788865231992], [26.459279347155324, -0.27196038217611296], [25.230551280721837, 0.5884042723504558], [24.00182321428835, 1.4487689268770245], [21.83449995497045, 2.663966785268049], [19.62653340689107, 3.7616693133515664], [18.14263452578564, 3.926859461081901], [16.67255570173341, 3.720990237917036], [15.216285806103823, 3.3915639709981322], [13.947959980040832, 2.6037865448206956], [12.756543402646134, 1.7183259725294193], [11.815786699218508, 0.5589207374156935], [11.19473269873334, -0.7893395543880297], [10.685109361404159, -2.1927381892393663], [10.155950988674178, -3.8740584891667074], [9.302095590814297, -5.49215131234995], [8.1994421630363, -6.485966840595875], [6.755312198107163, -6.829481804414132], [5.317230655206425, -6.805794264195603], [3.885197534334087, -6.414904219940286], [2.8158729094092005, -5.385312683211987], [2.0588065135488827, -4.162410358472828], [1.613998346753133, -2.7461972457228097], [1.6095724329020948, -1.0832988283185583]]

#Points from racetrack 1B:
yellow_points=[[3.0, 0.0], [6.0, 0.0], [9.0, 0.0], [12.0, 0.0], [14.968847511054276, -0.37305093947226275], [17.753106463250436, -1.4690092573155287], [20.17966512028001, -3.2197335735141515], [22.097651817694757, -5.516372329582325], [23.387815432267033, -8.216131651256777], [23.969939839248653, -11.151153579987566], [24.0, -15.0], [24.734504628657763, -18.87655323162522], [26.758186164791162, -21.04882590884738], [29.575576789993782, -21.984969919624326], [32.49688101928285, -21.45578456095409], [34.806861693281604, -19.59083286462374], [36.664216154692454, -15.233042997596288], [37.69027658466946, -12.413965135238563], [38.71633701464647, -9.594887272880838], [39.74239744462348, -6.775809410523113], [41.41644517267064, -4.3239489438339325], [44.06104479140185, -2.974820187747273], [47.02870608051554, -3.0587369142634477], [49.59284205563091, -4.555153382033144], [51.905182657112405, -7.269337941714823], [53.83354548617202, -9.567471271071756], [55.761908315231636, -11.86560460042869], [57.69027114429125, -14.163737929785622], [59.20363258912161, -16.737977979647624], [59.79141630610384, -19.66568783533057], [59.500156210803205, -23.72181219596864], [59.238688982560234, -26.710396290243875], [58.97722175431726, -29.69898038451911], [58.71575452607429, -32.68756447879435], [57.91105956262807, -37.60499049322057], [56.57660754008259, -40.28313543830076], [54.621056736391054, -42.54787462891757], [52.165993828970606, -44.25839755128446], [49.3640627385007, -45.30835217487179], [46.389473969254055, -45.632457406557485], [43.42717304371586, -45.21056195281351], [40.66134148576471, -44.06889722953622], [37.24673329439849, -41.74318018442071], [34.789277161531516, -40.02245087536757], [30.373344065372752, -37.82704581920054], [27.433186417268292, -38.23878426553027], [25.050353262478897, -40.00970541011282], [22.78615577396048, -42.56671592971564], [20.291413949764475, -44.21883147589923], [17.465487680068122, -45.20237774607383], [14.484079373169688, -45.45620259688893], [11.532558557375648, -44.964524428501534], [8.794436501553319, -43.75791340801747], [5.6244042885658665, -41.574929636495376], [3.1669481556988903, -39.854200327442236], [0.7094920228319141, -38.133471018389095], [-1.747964110035062, -36.412741709335954], [-3.6830040228380994, -34.16114758966155], [-4.30168958333295, -31.25748030136416], [-3.4525449888972184, -28.412658865555976], [-1.5006884486096055, -25.598914692628764], [0.22004086044353066, -23.141458559761787], [2.415445916610563, -18.72552546360303], [2.0037074702808337, -15.78536781549857], [0.23278632569828117, -13.402534660709176], [-2.4637342579091657, -12.160426659738839], [-5.826374857763842, -11.102109914278875], [-7.814005914255694, -8.896803058722885], [-8.50103584189221, -6.00854312886461], [-7.719255753381579, -3.1444768871199336], [-5.660072679924978, -1.0058276372701584], [-2.8276464544249413, -0.11621130367865895], [0.49815038038356185, -0.1073594759765825]]
blue_points=[[3.0, -3.0], [6.0, -3.0], [9.0, -3.0], [12.0, -3.0], [14.94475227116537, -3.4953874831673613], [17.56532822762763, -4.927014653007467], [19.57323886327107, -7.1372792471867434], [20.747441112269815, -9.882861840273096], [21.0, -15.0], [21.495387483167363, -18.94475227116537], [22.92701465300747, -21.56532822762763], [25.137279247186743, -23.57323886327107], [27.882861840273097, -24.747441112269815], [30.861511932129382, -24.958671619765884], [33.74532152892428, -24.183676841431136], [36.216823257748885, -22.507772935644923], [38.00393911391737, -20.115453639722308], [39.48329401705018, -16.259103427573294], [40.509354447027185, -13.440025565215569], [41.53541487700419, -10.620947702857844], [42.5614753069812, -7.801869840500119], [44.72079898037038, -5.901375229112199], [47.48669761248492, -6.6915418262551345], [49.60704932775547, -9.197700770774441], [51.535412156815084, -11.495834100131376], [53.4637749858747, -13.793967429488308], [55.392137814934316, -16.09210075884524], [56.678487401598346, -18.767798851826303], [56.511572116527965, -23.460344967725664], [56.250104888284994, -26.4489290620009], [55.98863766004202, -29.437513156276136], [55.72717043179905, -32.42609725055138], [54.80270449067011, -37.308857382420086], [53.14812685051918, -39.79468672686936], [50.771272037597456, -41.60231940396483], [47.933798746044396, -42.532760168729304], [44.94807336529489, -42.483580419231004], [42.14278278019303, -41.46019416265365], [38.96746260345162, -39.28572405155373], [36.51000647058465, -37.56499474250059], [32.17535995194885, -35.13459902571854], [29.207562189737978, -34.80421873025788], [26.295022398478814, -35.46307126409569], [23.758370746352824, -37.03862611645056], [20.242307873062916, -40.75607959688174], [17.566486931933873, -42.08158213857216], [14.604253944288615, -42.45861055118685], [11.681709608861572, -41.84565924441297], [7.345133597619003, -39.117473503628396], [4.887677464752026, -37.396744194575255], [2.4302213318850505, -35.676014885522115], [-0.027234800981925877, -33.955285576468974], [-1.3040975376308697, -31.377654872483088], [0.9567676842573716, -27.3196440016819], [2.6774969933105077, -24.862187868814924], [5.107892710092555, -20.527541350179128], [5.438273005553224, -17.559743587968256], [4.779420471715415, -14.647203796709091], [3.2038656193605433, -12.110552144583105], [0.8850551491330942, -10.229038737727857], [-1.9217421205695824, -9.209792063069495], [-5.157927766936066, -7.502081267349734], [-5.110552686499008, -4.625918181548259], [-2.664748037020689, -3.111785389827621], [0.4981503803835628, -3.1073594759765824]]

midpoints=[[0.4981503803835623, -1.6073594759765824], [1.749075190191781, -1.5536797379882912], [3.0, -1.5], [4.5, -1.5], [6.0, -1.5], [7.5, -1.5], [9.0, -1.5], [10.5, -1.5], [12.0, -1.5], [13.48442375552714, -1.6865254697361314], [14.956799891109824, -1.934219211319812], [16.3489293672079, -2.482198370241445], [17.659217345439032, -3.198011955161498], [18.87249667395382, -4.07337411326081], [19.87645199177554, -5.1785064103504475], [20.835445340482913, -6.326825788384534], [21.480527147769052, -7.67670544922176], [22.067628272268422, -9.049496745764937], [22.358690475759232, -10.517007710130331], [22.484969919624326, -13.075576789993782], [22.5, -15.0], [22.74769374158368, -16.972376135582685], [23.11494605591256, -18.910652751395297], [23.830759640832618, -20.220940729626427], [24.842600408899315, -21.307077068237504], [25.947732705988955, -22.311032386059225], [27.32052400253213, -22.898133510558598], [28.72921931513344, -23.366205515947073], [30.218544361061582, -23.471820769695107], [31.679196475706117, -23.207228090359987], [33.121101274103566, -22.81973070119261], [34.35685213851587, -21.981778748299504], [35.511842475515245, -21.04930290013433], [36.40540040359949, -19.853143252173023], [37.33407763430491, -17.6742483186593], [38.07375508587131, -15.74607321258479], [38.586785300859816, -14.336534281405928], [39.09981551584832, -12.926995350227067], [39.612845730836824, -11.517456419048203], [40.12587594582533, -10.10791748786934], [40.63890616081383, -8.698378556690479], [41.151936375802336, -7.288839625511616], [41.98896023982592, -6.062909392167025], [43.06862207652051, -5.112662086473065], [44.390921885886115, -4.438097708429736], [45.87475253044296, -4.480056071687823], [47.257701846500225, -4.875139370259291], [48.539769834057914, -5.623347604144139], [49.69594013479866, -6.980439883984978], [50.756115992433934, -8.233519356244631], [51.720297406963745, -9.3825860209231], [52.684478821493556, -10.531652685601566], [53.64866023602336, -11.680719350280032], [54.612841650553165, -12.829786014958499], [55.577023065082976, -13.978852679636965], [56.54120447961279, -15.127919344315432], [57.29788520202796, -16.415039369246433], [57.94105999535998, -17.75288841573696], [58.23495185385109, -19.216743343578436], [58.15149421131591, -21.563016401528117], [58.005864163665585, -23.59107858184715], [57.875130549544096, -25.08537062898477], [57.744396935422614, -26.57966267612239], [57.61366332130113, -28.073954723260005], [57.48292970717964, -29.56824677039762], [57.352196093058154, -31.062538817535245], [57.22146247893667, -32.55683086467286], [56.81911499721356, -35.015543871885974], [56.35688202664909, -37.45692393782033], [55.68965601537635, -38.795996410360424], [54.86236719530089, -40.03891108258506], [53.884591793455115, -41.17128067789346], [52.696164386994255, -42.0750970164412], [51.46863293328403, -42.930358477624644], [50.067667388049074, -43.455335789418314], [48.64893074227255, -43.92055617180055], [47.16163635764923, -44.082608787643395], [45.66877366727447, -44.05801891289424], [44.18762320450537, -43.847071186022255], [42.78497791195444, -43.33537805773358], [41.40206213297887, -42.764545696094935], [39.694758037295756, -41.60168717353718], [38.10709794892506, -40.51445211798722], [36.87836988249157, -39.65408746346065], [35.64964181605808, -38.79372280893408], [33.48231855674018, -37.578524950543056], [31.2743520086608, -36.48082242245954], [29.790453127555367, -36.31563227472921], [28.320374303503137, -36.52150149789408], [26.864104407873555, -36.85092776481298], [25.595778581810556, -37.638705190990414], [24.40436200441586, -38.52416576328169], [22.646330567770907, -40.38289250349728], [21.5142318235117, -41.661397763298694], [20.266860911413694, -42.487455536390485], [18.928950440849174, -43.15020680723569], [17.515987306000998, -43.64197994232299], [16.03487081217837, -43.830494148630336], [14.544166658729152, -43.95740657403789], [13.068406250832131, -43.71156748984419], [11.60713408311861, -43.40509183645725], [10.238073055207446, -42.80178632621522], [8.06978504958616, -41.43769345582294], [6.484768943092435, -40.346201570061886], [5.256040876658947, -39.485836915535316], [4.0273128102254585, -38.625472261008746], [2.79858474379197, -37.765107606482175], [1.5698566773584823, -36.904742951955605], [0.34112861092499425, -36.044378297429034], [-0.887599455508494, -35.184013642902464], [-1.8551194119100125, -34.05821658306526], [-2.4935507802344845, -32.76940123107232], [-2.80289356048191, -31.317567586923623], [-2.378321263264044, -29.89515686901953], [-1.2478886523199235, -27.86615143361894], [-0.27196038217611695, -26.45927934715533], [0.5884042723504511, -25.230551280721844], [1.4487689268770192, -24.001823214288358], [2.663966785268043, -21.834499954970457], [3.7616693133515593, -19.626533406891078], [3.926859461081894, -18.142634525785645], [3.7209902379170288, -16.672555701733415], [3.3915639709981242, -15.21628580610383], [2.6037865448206885, -13.947959980040839], [1.7183259725294122, -12.756543402646141], [0.5589207374156877, -11.815786699218517], [-0.7893395543880357, -11.194732698733347], [-2.192738189239374, -10.685109361404166], [-3.8740584891667122, -10.155950988674185], [-5.492151312349954, -9.302095590814304], [-6.48596684059588, -8.19944216303631], [-6.829481804414137, -6.7553121981071715], [-6.805794264195608, -5.317230655206434], [-6.4149042199402935, -3.885197534334096], [-5.385312683211993, -2.8158729094092085], [-4.162410358472833, -2.0588065135488898], [-2.746197245722815, -1.61399834675314], [-1.0832988283185636, -1.6095724329021017]]
#plot yellow_points as yellow points, blue_points as blue points and midpoints as red points

#yellow_points
yellow_points_np=np.array(yellow_points).reshape(-1,2)
x_yellow=yellow_points_np[:,0]
y_yellow=yellow_points_np[:,1]

#blue_points
blue_points_np=np.array(blue_points).reshape(-1,2)
x_blue=blue_points_np[:,0]
y_blue=blue_points_np[:,1]

#midpoints
midpoints_np=np.array(midpoints).reshape(-1,2)
x_mid=midpoints_np[:,0]
y_mid=midpoints_np[:,1]

#plot
fig_1, ax_1 = plt.subplots()
ax_1.set_aspect('equal') # Set the aspect ratio to 1

ax_1.scatter(x_yellow, y_yellow, c='y', marker='o') # Create a scatter plot object
ax_1.scatter(x_blue, y_blue, c='b', marker='o') # Create a scatter plot object
ax_1.scatter(x_mid, y_mid, c='r', marker='o') # Create a scatter plot object


def transform_points(list_of_points, x_shift, y_shift, theta):
    #list_of_points: list of points to be transformed
    #x_shift: shift in x direction
    #y_shift: shift in y direction
    #theta: rotation angle in degrees
    #returns: list of transformed points
    list_of_points_np=np.array(list_of_points).reshape(-1,2)
    x=list_of_points_np[:,0]
    y=list_of_points_np[:,1]

    #shift
    x=x-x_shift
    y=y-y_shift

    #rotate
    theta=np.deg2rad(theta)
    x_rot=x*np.cos(theta)-y*np.sin(theta)
    y_rot=x*np.sin(theta)+y*np.cos(theta)

    transform_points_np=np.array([x_rot,y_rot]).T

    return transform_points_np

#oriantation=90 #degrees
#pos=[0,0] #position of the car x,y in meters
pos=midpoints_np[0,:]

def car_view(pos,oriantation):
    yellow_points_tran=transform_points(yellow_points_np, pos[0], pos[1], oriantation)
    blue_points_tran=transform_points(blue_points_np, pos[0], pos[1], oriantation)
    midpoints_tran=transform_points(midpoints_np, pos[0], pos[1], oriantation)
    ########################
    #only the points that are in front of the car within in 20 meters and 5 meters to the left and right
    view_depth=20 #meters from the car
    view_width=10 #meters from the center of the car

    yellow_points_tran=yellow_points_tran[np.logical_and(np.logical_and(np.abs(yellow_points_tran[:,0])<view_width, yellow_points_tran[:,1]<view_depth), yellow_points_tran[:,1]>0)]
    blue_points_tran=blue_points_tran[np.logical_and(np.logical_and(np.abs(blue_points_tran[:,0])<view_width, blue_points_tran[:,1]<view_depth), blue_points_tran[:,1]>0)]
    midpoints_tran=midpoints_tran[np.logical_and(np.logical_and(np.abs(midpoints_tran[:,0])<view_width, midpoints_tran[:,1]<view_depth), midpoints_tran[:,1]>0)]

    return yellow_points_tran, blue_points_tran, midpoints_tran

def get_middelpoint_with_DT(yel_points, blu_points):
    #generate the point array
    point_array=[]
    for i in range(yel_points.shape[0]):
        point_array.append([yel_points[i,0],yel_points[i,1],'yellow'])

    for i in range(blu_points.shape[0]):
        point_array.append([blu_points[i,0],blu_points[i,1],'blue'])
    
    # convert the point array to a NumPy array, without color information
    point_array_without_color = DT.remove_Colors(point_array)


    # Use the filter function to remove the triangles that are made by three points of the same color
    tri = DT.delaunay_triangles_filtered(point_array, point_array_without_color)

    # Find the midpoints of the triangles that are made by two points of different color
    midpoints = DT.find_midpoints(tri, point_array)

    midpoints_np=np.array(midpoints).reshape(-1,2)
    return midpoints_np

#plot
fig_2, ax_2 = plt.subplots()
ax_2.set_aspect('equal') # Set the aspect ratio to 1
plt.xlim([-10, 10]) # Set the x axis limits
plt.ylim([-1, 22]) # Set the y axis limits

#set the axis fixed
#ax_2.set_autoscale_on(False)


#ax_2.scatter(yellow_points_tran[:,0], yellow_points_tran[:,1], c='y', marker='o') # Create a scatter plot object
#ax_2.scatter(blue_points_tran[:,0], blue_points_tran[:,1], c='b', marker='o') # Create a scatter plot object
#ax_2.scatter(midpoints_tran[:,0], midpoints_tran[:,1], c='r', marker='o') # Create a scatter plot object
#yellow_disp=ax_2.scatter([],[], c='y', marker='o')
#blue_disp=ax_2.scatter([],[], c='b', marker='o')

#plot the car
car_pos=[0.2,0] #position of the car's back right coner x,y in meters
car_width=0.7
car_length=0.4
car_theta=90
#rotat the rectangle 45 degrees
car=ax_2.add_patch(Rectangle(car_pos, car_width, car_length, edgecolor='red', facecolor='red', lw=4, angle=car_theta))

oriantation_=90
#    return fig_2, ax_2

#print(f"midpoints_np[0,:]={midpoints_np[0,:]}")
#yellow_points_tran, blue_points_tran, midpoints_tran=car_view(midpoints_np[9,:],110)
#ax_2.scatter(yellow_points_tran[:,0], yellow_points_tran[:,1], c='y', marker='o') # Create a scatter plot object
#ax_2.scatter(blue_points_tran[:,0], blue_points_tran[:,1], c='b', marker='o') # Create a scatter plot object
#ax_2.scatter(midpoints_tran[:,0], midpoints_tran[:,1], c='r', marker='o') # Create a scatter plot object

#for loop i from 75 to 86
oriantation_=90
pos_=midpoints_np[1,:]
diff_angle=0
print(f"midpoints_np[80,:]={midpoints_np[79,:]}, midpoints_np[81,:]={midpoints_np[80,:]}")
for i in range((midpoints_np.shape[0]-1)*20):
    plt.xlim([-10, 10]) # Set the x axis limits
    plt.ylim([-1, 22]) # Set the y axis limits
    #pos_=[pos_[0]+np.cos(np.deg2rad(90-oriantation_))*0.2, pos_[1]+np.sin(np.deg2rad(90-oriantation_))*0.2]
    pos_=[pos_[0]+np.cos(np.deg2rad(90-oriantation_))*1, pos_[1]+np.sin(np.deg2rad(90-oriantation_))*1]
    #transformed points
    yellow_points_tran, blue_points_tran, midpoints_tran=car_view(pos_,oriantation_)
    midpoints=get_middelpoint_with_DT(yellow_points_tran, blue_points_tran)
    #pos_now=midpoints_tran[0,:]
    pos_now=[0,0]
    #mid_points_next=midpoints_tran[1:3,:]
    mid_points_next=midpoints[1:3,:]
    print(f"pos_now={pos_now}, mid_points_next={mid_points_next}")
    #angle between vector from pos_ to mid_points_next and x axis
    angle_next=np.rad2deg(np.arctan2(mid_points_next[:,1]-pos_now[1], mid_points_next[:,0]-pos_now[0]))
    next_avg_angle=np.mean(angle_next)
    print(f"")
    print(f"i={i} , angle_next={angle_next[0]}, oriantation_={oriantation_}, diff angle={90-angle_next[0]}")
    #oriantation_=angle_next[0]q
    #diff_angle=90-angle_next[0]
    diff_angle=90-next_avg_angle
    oriantation_+=diff_angle
 
    
    #angle_next=
    #print(mid_points_next)
    ax_2.add_patch(Rectangle(car_pos, car_width, car_length, edgecolor='red', facecolor='red', lw=4, angle=car_theta))

    
    ax_2.scatter(yellow_points_tran[:,0], yellow_points_tran[:,1], c='y', marker='o') # Create a scatter plot object
    ax_2.scatter(blue_points_tran[:,0], blue_points_tran[:,1], c='b', marker='o') # Create a scatter plot object
    #ax_2.scatter(midpoints_tran[:,0], midpoints_tran[:,1], c='r', marker='o') # Create a scatter plot object
    ax_2.scatter(midpoints[:,0], midpoints[:,1], c='r', marker='o') # Create a scatter plot object
    
    plt.pause(0.03)
    #plt.pause(8)
    ax_2.clear()

"""
def ani(i):
    y_points,b_points=car_view(midpoints_np[i,:],oriantation)
    yellow_disp.set_data(y_points)
    blue_disp.set_data(b_points)
    return yellow_disp, blue_disp

anim=animation.FuncAnimation(fig_2, ani, frames=40)
"""
"""
for i in range(40):
    fig_2,ax_3=car_view(midpoints_np[i,:],oriantation)
"""    

plt.show()


