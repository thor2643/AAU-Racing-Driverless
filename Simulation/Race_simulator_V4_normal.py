import numpy as np
import matplotlib.pyplot as plt
import matplotlib.animation as animation
from matplotlib.patches import Rectangle
import DelanayTriangles_copy_2 as DT

import keyboard


race_track_number=4

def race_track(number):
    if number==1:
        #Points from racetrack 1:
        yellow_points=[[3.0, 1.232595164407831e-32], [6.0, 2.465190328815662e-32], [9.0, -1.232595164407831e-32], [12.0, 4.930380657631324e-32], [14.968847511054276, -0.3730509394722618], [17.75310646325044, -1.4690092573155276], [20.17966512028001, -3.21973357351415], [22.09765181769476, -5.516372329582323], [23.387815432267033, -8.216131651256775], [23.969939839248653, -11.151153579987565], [24.0, -14.999999999999998], [24.734504628657763, -18.87655323162522], [26.758186164791162, -21.048825908847377], [29.575576789993782, -21.984969919624323], [32.49688101928285, -21.455784560954086], [34.806861693281604, -19.590832864623735], [36.664216154692454, -15.233042997596286], [37.69027658466946, -12.413965135238561], [38.71633701464647, -9.594887272880836], [39.74239744462348, -6.77580941052311], [41.41644517267064, -4.323948943833932], [44.06104479140184, -2.9748201877472704], [47.02870608051554, -3.058736914263444], [49.59284205563091, -4.55515338203314], [51.905182657112405, -7.269337941714818], [53.83354548617202, -9.567471271071753], [55.761908315231636, -11.865604600428687], [57.69027114429125, -14.163737929785622], [59.203632589121604, -16.73797797964762], [59.791416306103834, -19.665687835330566], [59.5001562108032, -23.721812195968635], [59.23868898256023, -26.71039629024387], [58.977221754317256, -29.698980384519107], [58.715754526074285, -32.68756447879434], [57.91105956262807, -37.60499049322057], [56.57660754008259, -40.28313543830076], [54.621056736391054, -42.54787462891757], [52.165993828970606, -44.25839755128446], [49.3640627385007, -45.30835217487179], [46.389473969254055, -45.632457406557485], [43.42717304371586, -45.21056195281351], [40.66134148576471, -44.06889722953622], [37.24673329439849, -41.74318018442071], [34.789277161531516, -40.02245087536757], [30.37334406537276, -37.82704581920054], [27.4331864172683, -38.23878426553027], [25.050353262478904, -40.009705410112815], [22.786155773960484, -42.56671592971565], [20.29141394976448, -44.21883147589923], [17.465487680068126, -45.202377746073836], [14.48407937316969, -45.45620259688893], [11.532558557375651, -44.964524428501534], [8.79443650155332, -43.75791340801747], [5.624404288565869, -41.57492963649537], [3.1669481556988925, -39.85420032744223], [0.7094920228319165, -38.13347101838909], [-1.7479641100350598, -36.41274170933595], [-3.6830040228380945, -34.161147589661546], [-4.301689583332946, -31.257480301364154], [-3.452544988897214, -28.41265886555597], [-1.5006884486096, -25.598914692628757], [0.2200408604435374, -23.14145855976178], [2.4154459166105715, -18.725525463603024], [2.0037074702808417, -15.785367815498564], [0.2327863256982891, -13.402534660709168], [-2.4637342579091572, -12.160426659738832], [-5.826374857763839, -11.102109914278866], [-7.814005914255689, -8.896803058722876], [-8.501035841892204, -6.0085431288646], [-7.719255753381572, -3.1444768871199242], [-5.660072679924972, -1.0058276372701518], [-2.8276464544249356, -0.11621130367865201]]
        blue_points=[[3.0, -3.0], [6.0, -3.0], [9.0, -3.0], [12.0, -3.0], [14.944752271165372, -3.4953874831673604], [17.56532822762763, -4.9270146530074665], [19.57323886327107, -7.137279247186743], [20.747441112269815, -9.882861840273094], [21.0, -14.999999999999998], [21.495387483167363, -18.94475227116537], [22.92701465300747, -21.56532822762763], [25.137279247186743, -23.57323886327107], [27.882861840273094, -24.747441112269815], [30.86151193212938, -24.95867161976588], [33.74532152892428, -24.183676841431133], [36.216823257748885, -22.50777293564492], [38.00393911391737, -20.115453639722304], [39.48329401705018, -16.25910342757329], [40.509354447027185, -13.440025565215567], [41.53541487700419, -10.620947702857842], [42.5614753069812, -7.801869840500117], [44.72079898037038, -5.901375229112197], [47.48669761248492, -6.691541826255132], [49.60704932775547, -9.197700770774437], [51.535412156815084, -11.495834100131372], [53.4637749858747, -13.793967429488307], [55.392137814934316, -16.09210075884524], [56.67848740159834, -18.7677988518263], [56.51157211652796, -23.46034496772566], [56.25010488828499, -26.448929062000897], [55.988637660042016, -29.437513156276133], [55.727170431799046, -32.42609725055138], [54.80270449067011, -37.308857382420086], [53.14812685051918, -39.79468672686936], [50.771272037597456, -41.60231940396483], [47.93379874604439, -42.532760168729304], [44.94807336529489, -42.483580419231004], [42.14278278019303, -41.46019416265365], [38.96746260345163, -39.285724051553736], [36.510006470584656, -37.564994742500595], [32.17535995194885, -35.13459902571854], [29.20756218973799, -34.80421873025788], [26.29502239847882, -35.46307126409569], [23.75837074635283, -37.03862611645056], [20.24230787306292, -40.75607959688174], [17.566486931933877, -42.08158213857216], [14.604253944288615, -42.45861055118685], [11.681709608861574, -41.84565924441297], [7.345133597619006, -39.117473503628396], [4.887677464752031, -37.396744194575255], [2.4302213318850536, -35.676014885522115], [-0.027234800981922467, -33.955285576468974], [-1.304097537630865, -31.37765487248308], [0.9567676842573772, -27.319644001681894], [2.6774969933105144, -24.862187868814917], [5.107892710092563, -20.52754135017912], [5.438273005553232, -17.55974358796825], [4.779420471715425, -14.647203796709084], [3.2038656193605513, -12.110552144583098], [0.8850551491330994, -10.229038737727848], [-1.921742120569574, -9.209792063069488], [-5.1579277669360595, -7.502081267349726], [-5.110552686499002, -4.62591818154825], [-2.6647480370206837, -3.111785389827614]]
        lab_time=920
    elif number==2:
        #Points from racetrack 2:
        yellow_points=[[3.0, 1.232595164407831e-32], [6.0, 2.465190328815662e-32], [9.0, -1.232595164407831e-32], [10.979231674036184, -0.24870062631484147], [12.835404308833624, -0.979339504877018], [14.453110080186674, -2.146489049009433], [15.731767878463174, -3.677581553054882], [16.59187695484469, -5.477421100837851], [16.979959892832436, -7.434102386658377], [17.394695029985574, -9.94709171154325], [20.585786437626904, -13.656854249492378], [22.707106781186546, -15.77817459305202], [24.828427124746188, -17.899494936611664], [26.94974746830583, -20.020815280171306], [28.605640753333617, -21.118525500792238], [30.558287962853473, -21.484748349628926], [32.49940903730033, -21.061665291360182], [34.12254364040041, -19.916071838133913], [35.17143450781723, -18.228832006899086], [35.48528137423857, -13.48528137423857], [35.48528137423857, -10.48528137423857], [35.48528137423857, -7.4852813742385695], [35.48528137423857, -4.4852813742385695], [35.48528137423857, -1.485281374238569], [35.48528137423857, 1.514718625761431], [35.73398200055341, 3.4939502997976155], [36.464620879115586, 5.350122934595056], [37.631770423248, 6.967828705948105], [39.16286292729345, 8.246486504224602], [40.96270247507642, 9.10659558060612], [42.91938376089695, 9.494678518593865], [44.91124981943451, 9.386606200752926], [46.814456066615705, 8.789098040366884], [48.51067035602048, 7.7393042008648], [50.79802890875873, 6.073862654632885], [52.75067611827859, 5.707639805796192], [54.691797192725446, 6.130722864064934], [56.31493179582553, 7.276316317291203], [57.36382266324235, 8.963556148526031], [57.67287299002924, 10.926064287456583], [57.19329052498693, 12.854003850586007], [54.09188309203678, 16.36396103067893], [51.970562748477136, 18.48528137423857], [49.84924240491749, 20.606601717798213], [47.727922061357845, 22.727922061357855], [45.6066017177982, 24.849242404917497], [43.485281374238554, 26.97056274847714], [41.36396103067891, 29.09188309203678], [39.24264068711926, 31.213203435596423], [37.12132034355962, 33.334523779156065], [34.99999999999997, 35.45584412271571], [32.878679656440326, 37.577164466275356], [31.222786371412578, 38.67487468689628], [29.270139161892722, 39.04109753573297], [27.329018087445863, 38.618014477464236], [24.232225806972128, 36.35349422737774], [22.403073844224107, 35.557621675889415], [20.433883766020934, 35.239030312315876], [18.447090273808133, 35.417528604571935], [16.566222564053596, 36.08201839338753], [14.908223881115157, 37.1911849220981], [12.372583002030481, 39.69848480983501], [10.25126265847084, 41.819805153394654], [8.129942314911196, 43.9411254969543], [6.0086219713515545, 46.062445840513945], [3.8873016277919117, 48.18376618407359], [1.7659812842322693, 50.305086527633236], [0.11008799920448405, 51.40279674825415], [-1.842559210315372, 51.76901959709084], [-3.7836802847622293, 51.3459365388221], [-5.40681488786231, 50.20034308559583], [-6.455705755279133, 48.513103254361006], [-6.7695526217004725, 43.769552621700484], [-6.769552621700473, 40.769552621700484], [-6.769552621700474, 37.769552621700484], [-6.769552621700474, 34.769552621700484], [-6.769552621700475, 31.769552621700484], [-6.769552621700476, 28.769552621700484], [-6.769552621700477, 25.769552621700484], [-7.018253248015317, 23.7903209476643], [-7.748892126577495, 21.934148312866856], [-8.91604167070991, 20.31644254151381], [-10.44713417475536, 19.03778474323731], [-12.246973722538328, 18.177675666855794], [-14.203655008358854, 17.789592728868048], [-16.753132312805576, 17.548243390205513], [-18.639159893455677, 16.89519964593057], [-20.33488084932811, 15.842537968693016], [-21.75689991340642, 14.442028080006986], [-22.835282430970082, 12.762546817020544], [-23.516993733970295, 10.886690781427381], [-23.768507376947397, 8.906714252701383], [-23.57745396189301, 6.919992138387055], [-22.953229463131613, 5.024231092776201], [-21.926533134907913, 3.312664320335958], [-20.547857727305907, 1.8694663826354803], [-18.885006261422774, 0.7656135077831052], [-17.019757488370736, 0.055392991649317505], [-15.043844024263343, -0.226266642073111], [-11.769552621700479, -0.23044737829951764], [-8.769552621700479, -0.23044737829951836], [-5.769552621700479, -0.2304473782995191], [-2.7695526217004787, -0.23044737829951983], [35.4, -15.999999999999998], [55.6, 14.500000000000004], [25.599999999999998, 37.5], [-6.8000000000000025, 46.2], [19.0, -11.999999999999998]]
        blue_points=[[3.0, -3.0], [6.0, -3.0], [9.0, -3.0], [10.947091711543253, -3.3946950299855736], [12.586780454497614, -4.516466453264171], [13.660195429836133, -6.188211227616633], [14.248700626314843, -9.979231674036184], [14.979339504877018, -11.835404308833622], [16.146489049009432, -13.453110080186672], [18.464466094067262, -15.77817459305202], [20.585786437626904, -17.899494936611664], [22.707106781186546, -20.020815280171306], [24.828427124746188, -22.142135623730947], [26.403813162348946, -23.365805862628573], [28.232965125096968, -24.161678414116896], [30.20215520330014, -24.480269777690427], [32.18894869551294, -24.301771485434372], [34.069816405267474, -23.637281696618775], [35.727815088205915, -22.5281151679082], [37.059858416609266, -21.043234501897096], [37.98312638796443, -19.2749623864954], [38.44021467158828, -17.333241417351978], [38.48528137423857, -13.48528137423857], [38.48528137423857, -10.48528137423857], [38.48528137423857, -7.485281374238569], [38.48528137423857, -4.485281374238569], [38.48528137423857, -1.485281374238569], [38.48528137423857, 1.514718625761431], [38.879976404224145, 3.4618103373046853], [40.00174782750274, 5.101499080259045], [41.6734926018552, 6.174914055597564], [43.63127898574501, 6.512586640968956], [45.56601555697428, 6.061205759889838], [48.59620131777406, 3.8265822927965476], [50.42535328052208, 3.030709741308226], [52.39454335872526, 2.712118377734688], [54.381336850938055, 2.890616669990744], [56.262204560692595, 3.555106458806341], [57.920203243631036, 4.664272987516915], [59.25224657203439, 6.149153653528021], [60.175514543389546, 7.91742576892972], [60.6326028270134, 9.859146738073141], [60.595091887301336, 11.85358975566963], [60.06531397280337, 13.776750014812807], [59.07620810830535, 15.509054725264491], [56.21320343559643, 18.48528137423857], [54.09188309203678, 20.606601717798213], [51.970562748477136, 22.727922061357855], [49.84924240491749, 24.849242404917497], [47.727922061357845, 26.97056274847714], [45.6066017177982, 29.09188309203678], [43.485281374238554, 31.213203435596423], [41.36396103067891, 33.334523779156065], [39.24264068711926, 35.45584412271571], [37.12132034355962, 37.577164466275356], [34.99999999999997, 39.698484809835], [33.42461396239725, 40.92215504873262], [31.595461999649228, 41.71802760022094], [29.626271921446055, 42.03661896379448], [27.63947842923325, 41.85812067153842], [25.758610719478717, 41.19363088272283], [24.100612036540277, 40.084464354012255], [22.030398215987454, 38.60077458921407], [20.0777510064676, 38.234551740377384], [18.136629932020742, 38.65763479864612], [14.493903345590125, 41.819805153394654], [12.372583002030481, 43.9411254969543], [10.25126265847084, 46.062445840513945], [8.129942314911197, 48.18376618407359], [6.0086219713515545, 50.305086527633236], [3.887301627791912, 52.42640687119288], [2.311915590189155, 53.650077110090486], [0.4827636274411342, 54.44594966157881], [-1.4864264507620395, 54.76454102515235], [-3.473219942974841, 54.58604273289629], [-5.354087652729376, 53.921552944080695], [-7.012086335667817, 52.81238641537012], [-8.34412966407117, 51.32750574935901], [-9.267397635426331, 49.55923363395731], [-9.724485919050181, 47.617512664813894], [-9.769552621700473, 43.769552621700484], [-9.769552621700472, 40.769552621700484], [-9.769552621700473, 37.769552621700484], [-9.769552621700475, 34.769552621700484], [-9.769552621700475, 31.769552621700484], [-9.769552621700475, 28.769552621700484], [-9.769552621700477, 25.769552621700484], [-10.164247651686052, 23.82246091015723], [-11.28601907496465, 22.18277216720287], [-12.957763849317109, 21.10935719186435], [-16.760306214021455, 20.603271400455583], [-18.695888983254303, 20.109035977477337], [-20.52265908495091, 19.300543364384957], [-22.189990258537318, 18.20019975102386], [-23.651674860052918, 16.83849955069717], [-24.867204439395234, 15.25318029211816], [-25.802892372745532, 13.488176779016785], [-26.43280743806023, 11.592403501336358], [-26.73949246094913, 9.618399041712918], [-26.714448114721655, 7.620870045527973], [-26.358368466790473, 5.655175106274478], [-25.681121743608657, 3.775790583134775], [-24.701476847212007, 2.0348008683915926], [-23.446583202560376, 0.48045494470197025], [-21.951218350947954, -0.8441707648627204], [-20.256824141330227, -1.9023661968560108], [-18.410358230114767, -2.664805013153303], [-16.462992718418896, -3.110357337504861], [-11.769552621700479, -3.230447378299518], [-8.769552621700479, -3.2304473782995182], [-5.7695526217004796, -3.230447378299519], [-2.7695526217004796, -3.2304473782995196], [-15.000000000000002, 21.0], [57.5, 17.000000000000004], [-14.0, -3.3000000000000007]]
        lab_time=1100
    elif number==3:
        #Points from racetrack 3:
        yellow_points=[[1.99075359232098, -0.1662812212448993], [3.9263363615538296, -0.6605166442231487], [5.753106463250438, -1.4690092573155282], [7.420437636836844, -2.569352870676624], [8.882122238352443, -3.9310530710033187], [10.097651817694759, -5.516372329582324], [11.033339751045062, -7.281375842683705], [11.663254816359753, -9.177149120364128], [11.969939839248653, -11.151153579987566], [12.394695029985574, -13.947091711543251], [13.516466453264176, -15.586780454497614], [15.188211227616636, -16.660195429836133], [17.145997611506445, -16.997868015207526], [19.08073418273571, -16.54648713412841], [20.686968577706228, -15.377315902755752], [21.711111703343292, -13.674940750779523], [22.330258322111575, -10.036831819223085], [23.284676435338312, -8.289781181581573], [24.758186164791162, -6.951174091152619], [26.588574560182064, -6.1683725918201215], [31.0, -5.999999999999998], [34.0, -5.999999999999998], [37.0, -5.999999999999997], [40.0, -5.999999999999997], [41.979231674036185, -6.2487006263148395], [43.835404308833624, -6.979339504877016], [45.453110080186676, -8.14648904900943], [46.731767878463174, -9.677581553054878], [47.59187695484469, -11.477421100837848], [47.97995989283243, -13.434102386658374], [47.8718875749915, -15.425968445195934], [47.274379414605455, -17.329174692377137], [46.22458557510337, -19.02538898178191], [43.53553390593274, -21.778174593052018], [41.41421356237309, -23.89949493661166], [39.29289321881345, -26.020815280171302], [37.1715728752538, -28.142135623730944], [36.07386265463289, -29.79802890875873], [35.7076398057962, -31.750676118278587], [36.130722864064936, -33.691797192725446], [37.276316317291204, -35.31493179582553], [38.96355614852603, -36.36382266324235], [42.68633845522274, -36.92637015597853], [44.54251109002018, -37.65700903454071], [46.16021686137323, -38.82415857867312], [47.43887465964973, -40.355251082718574], [48.298983736031246, -42.15509063050154], [48.687066674018986, -44.11177191632207], [48.57899435617805, -46.10363797485962], [47.98148619579201, -48.006844222040826], [46.93169235628992, -49.703058511445604], [45.494883934018205, -51.08681845403916], [43.76039471760521, -52.072088558723394], [41.83606684566549, -52.59760950246725], [37.70710678118655, -52.67766952966369], [34.70710678118655, -52.67766952966369], [31.707106781186557, -52.67766952966369], [28.707106781186557, -52.67766952966369], [25.707106781186557, -52.67766952966369], [22.707106781186557, -52.67766952966369], [20.851997371977344, -53.320007747332845], [18.464466094067273, -55.67766952966369], [16.34314575050763, -57.798989873223334], [14.221825406947989, -59.92031021678298], [12.100505063388347, -62.041630560342625], [10.525119025785589, -63.26530079924023], [8.695967063037568, -64.06117335072855], [6.726776984834395, -64.37976471430208], [4.739983492621593, -64.20126642204603], [2.8591157828670584, -63.53677663323044], [1.2011170999286176, -62.427610104519864], [-0.13092622847473462, -60.942729438508756], [-1.0541941998298947, -59.174457323107056], [-1.511282483453746, -57.23273635396364], [-1.4737715437416814, -55.23829333636715], [-0.9439936292437133, -53.31513307722397], [0.04511223525430324, -51.58282836677228], [2.9081169079632243, -48.6066017177982], [5.029437251522866, -46.485281374238554], [6.127147472143795, -44.829388089210774], [6.493370320980486, -42.87674087969092], [6.0702872627117435, -40.935619805244066], [2.908116907963222, -37.29289321881344], [0.7867965644035791, -35.171572875253794], [-1.3345237791560638, -33.05025253169415], [-3.455844122715707, -30.928932188134507], [-5.57716446627535, -28.807611844574865], [-7.6984848098349925, -26.686291501015223], [-9.819805153394634, -24.56497115745558], [-11.941125496954276, -22.44365081389594], [-13.1647957358519, -20.868264776293195], [-13.960668287340221, -19.039112813545174], [-14.27925965091376, -17.069922735341997], [-14.2842712474619, -13.786796564403566], [-14.2842712474619, -10.786796564403566], [-14.2842712474619, -7.786796564403567], [-14.03557062114706, -5.807564890367383], [-13.304931742584884, -3.951392255569942], [-12.13778219845247, -2.3336864842168925], [-10.60668969440702, -1.0550286859403932], [-8.806850146624052, -0.19491960955887552], [-6.850168860803526, 0.19316332842887055], [-3.284271247461903, 0.21320343559643576], [22.0, -11.799999999999999], [28.5, -5.999999999999998], [45.0, -20.199999999999996], [40.7, -36.7], [40.0, -52.7], [1.500000000000003, -50.0], [5.000000000000003, -39.5]]
        blue_points=[[1.983579691105103, -3.2213092314949723], [3.869607271755203, -3.874352975769914], [5.565328227627633, -4.927014653007467], [6.987347291705945, -6.327524541693495], [8.065729809269609, -8.007005804679945], [8.747441112269815, -9.882861840273097], [8.99895475524692, -11.862838368999105], [9.248700626314843, -13.979231674036184], [9.97933950487702, -15.835404308833624], [11.146489049009435, -17.453110080186676], [12.677581553054884, -18.731767878463174], [14.477421100837853, -19.59187695484469], [16.434102386658378, -19.979959892832436], [18.425968445195938, -19.871887574991497], [20.32917469237714, -19.274379414605455], [22.025388981781912, -18.22458557510337], [23.409148924375472, -16.78777715283165], [24.39441902905971, -15.05328793641865], [24.91993997280356, -13.128960064478935], [25.642338217669156, -10.144890590790785], [27.29428728009103, -9.08418629591006], [31.0, -8.999999999999998], [34.0, -8.999999999999998], [37.0, -8.999999999999998], [40.0, -8.999999999999998], [41.94709171154325, -9.394695029985572], [43.586780454497614, -10.516466453264169], [44.660195429836136, -12.18821122761663], [44.99786801520752, -14.145997611506441], [44.546487134128405, -16.080734182735707], [41.41421356237309, -19.656854249492376], [39.29289321881345, -21.778174593052018], [37.1715728752538, -23.89949493661166], [35.050252531694156, -26.020815280171302], [33.82658229279655, -27.59620131777406], [33.03070974130823, -29.42535328052208], [32.71211837773469, -31.394543358725254], [32.89061666999075, -33.38133685093806], [33.55510645880634, -35.262204560692595], [34.66427298751692, -36.920203243631036], [36.149153653528025, -38.25224657203439], [37.917425768929725, -39.175514543389546], [39.85914673807314, -39.6326028270134], [42.654198492729805, -40.072364559649266], [44.29388723568417, -41.19413598292786], [45.36730221102269, -42.86588075728032], [45.704974796394076, -44.823667141170134], [45.25359391531496, -46.7584037123994], [44.08442268394231, -48.36463810736991], [42.38204753196608, -49.38878123300698], [37.70710678118655, -49.67766952966369], [34.70710678118655, -49.67766952966369], [31.707106781186557, -49.67766952966369], [28.707106781186557, -49.67766952966369], [25.707106781186557, -49.67766952966369], [22.707106781186557, -49.67766952966369], [20.743938600409642, -50.007927851775264], [18.996887962768135, -50.962345965002], [16.34314575050763, -53.55634918610404], [14.221825406947989, -55.67766952966369], [12.100505063388347, -57.798989873223334], [9.979184719828705, -59.92031021678298], [8.323291434800918, -61.01802043740389], [6.370644225281061, -61.38424328624058], [4.429523150834205, -60.961160227971845], [2.806388547734125, -59.81556677474558], [1.757497680317302, -58.12832694351075], [1.448447353530408, -56.1658188045802], [1.9280298185727263, -54.23787924145077], [5.029437251522867, -50.727922061357845], [7.150757595082509, -48.6066017177982], [8.374427833980132, -47.031215680195444], [9.170300385468455, -45.20206371744743], [9.488891749041988, -43.232873639244254], [9.310393456785933, -41.24608014703145], [8.645903667970336, -39.36521243727692], [7.536737139259762, -37.707213754338476], [5.0294372515228645, -35.171572875253794], [2.9081169079632216, -33.05025253169415], [0.7867965644035785, -30.928932188134507], [-1.3345237791560645, -28.807611844574865], [-3.4558441227157073, -26.686291501015223], [-5.577164466275351, -24.56497115745558], [-7.6984848098349925, -22.44365081389594], [-9.819805153394634, -20.322330470336297], [-10.917515374015563, -18.66643718530852], [-11.2842712474619, -13.786796564403566], [-11.2842712474619, -10.786796564403566], [-11.2842712474619, -7.786796564403566], [-10.889576217476328, -5.839704852860314], [-9.76780479419773, -4.2000161099059525], [-8.09606001984527, -3.126601134567433], [-3.284271247461902, -2.786796564403564], [43.0, -17.999999999999996], [40.0, -49.7], [17.800000000000004, -52.3], [3.000000000000003, -52.7], [-11.299999999999999, -16.8], [-6.0, -2.7000000000000006]]
        lab_time=1000

    elif number==4:
        #Points from racetrack 4:
        yellow_points=[[3.0, 1.232595164407831e-32], [6.0, 2.465190328815662e-32], [9.0, -1.232595164407831e-32], [12.0, 4.930380657631324e-32], [15.0, 1.1093356479670479e-31], [18.0, 1.7256332301709633e-31], [21.0, 2.341930812374879e-31], [22.99075359232098, -0.16628122124489977], [24.92633636155383, -0.6605166442231492], [26.75310646325044, -1.469009257315529], [28.420437636836844, -2.5693528706766244], [29.882122238352444, -3.931053071003319], [31.09765181769476, -5.516372329582325], [32.03333975104506, -7.281375842683706], [32.66325481635975, -9.17714912036413], [32.96993983924865, -11.151153579987566], [33.0, -15.0], [33.0, -17.999999999999996], [33.0, -20.999999999999996], [33.39469502998558, -22.947091711543248], [34.51646645326417, -24.58678045449761], [36.188211227616634, -25.66019542983613], [38.145997611506445, -25.997868015207523], [40.08073418273571, -25.546487134128405], [43.11091994353549, -23.311863667035112], [44.940071906283514, -22.51599111554679], [46.90926198448669, -22.197399751973254], [48.896055476699495, -22.37589804422931], [50.77692318645403, -23.040387833044907], [52.43492186939247, -24.14955436175548], [53.76696519779582, -25.634435027766585], [54.69023316915098, -27.402707143168286], [55.14732145277483, -29.344428112311707], [55.10981051306277, -31.338871129908195], [54.5800325985648, -33.26203138905137], [53.59092673406678, -34.99433609950306], [50.72792206135786, -37.97056274847714], [48.60660171779821, -40.09188309203679], [46.48528137423857, -42.213203435596434], [44.36396103067892, -44.33452377915608], [42.24264068711928, -46.455844122715725], [40.12132034355963, -48.57716446627537], [37.999999999999986, -50.698484809835016], [36.37830256765461, -51.853126443963625], [34.46807569475212, -52.41360227696632], [32.47960882192495, -52.318211706112564], [30.631804526837872, -51.5774559080275], [27.3933982822018, -48.57716446627535], [25.27207793864216, -46.4558441227157], [23.150757595082517, -44.33452377915606], [21.029437251522875, -42.21320343559641], [19.87479561739424, -40.59150600325103], [19.314319784391547, -38.68127913034854], [19.409710355245302, -36.69281225752137], [20.150466153330367, -34.84500796243429], [21.886995985088532, -31.961959908733913], [21.468922800619122, -30.04382432477679], [19.954247287559532, -28.79490983765102], [17.991592092180316, -28.75003345114431], [15.165099132058183, -30.639923008367205], [13.254872259155695, -31.2003988413699], [11.26640538632852, -31.105008270516144], [9.418601091241444, -30.36425247243108], [7.9148769559231384, -29.05967836943804], [6.920772116989904, -27.334901446311914], [6.545723706478103, -25.37979568060218], [5.90181765961514, -23.387531277910078], [4.249868597193265, -22.326826983029353], [2.2957153676428685, -22.514748406642248], [0.8761761726451721, -23.870822807211855], [0.5441558772842967, -28.24264068711929], [0.5441558772842968, -31.24264068711929], [0.544155877284297, -34.24264068711929], [0.5441558772842973, -37.24264068711929], [0.5441558772842974, -40.24264068711929], [0.5441558772842976, -43.24264068711929], [0.5441558772842978, -46.24264068711929], [0.29545525096945574, -48.22187236115548], [-0.43518362759272083, -50.078044995952915], [-1.6023331717251357, -51.69575076730597], [-3.1334256757705847, -52.974408565582465], [-4.933265223553553, -53.834517641963984], [-6.889946509374079, -54.222600579951724], [-8.881812567911638, -54.11452826211079], [-10.78501881509284, -53.517020101724746], [-12.481233104497615, -52.46722626222266], [-15.234018715767725, -49.77817459305203], [-17.355339059327367, -47.65685424949238], [-19.47665940288701, -45.53553390593274], [-20.766756188562407, -44.010279962004844], [-21.78594267114427, -42.292139041241946], [-22.505973588465928, -40.42872690540658], [-22.906894337149662, -38.47168529543697], [-22.977593985243214, -36.47525075615524], [-22.71611319544215, -34.49475154978261], [-22.12969852525651, -32.585074314104126], [-21.234601599272022, -30.799142959608467], [-20.055628719152896, -29.186451960743153], [-18.23054601061196, -27.005879248521985], [-17.358694778817682, -25.210484696751177], [-16.90398320219003, -23.267084699583766], [-16.840620433565945, -19.201010126776673], [-16.840620433565945, -16.201010126776673], [-16.840620433565945, -13.201010126776675], [-16.840620433565945, -10.201010126776675], [-16.840620433565945, -7.201010126776674], [-16.55684450134937, -5.2281101619212045], [-15.728524927472604, -3.4151706332648546], [-14.422820900292821, -1.9091825707495467], [-12.745597384813424, -0.8322497361888058], [-10.832841714360335, -0.27168859217180574], [-6.840620433565949, -0.20101012677667182], [-3.840620433565949, -0.20101012677667107], [33.0, -12.999999999999998], [0.5000000000000016, -26.2]]
        blue_points=[[3.0, -3.0], [6.0, -3.0], [9.0, -3.0], [12.0, -3.0], [15.0, -3.0], [18.0, -3.0], [21.0, -3.0], [22.983579691105103, -3.2213092314949727], [24.869607271755203, -3.874352975769915], [26.56532822762763, -4.927014653007467], [27.987347291705944, -6.327524541693495], [29.06572980926961, -8.007005804679943], [29.747441112269815, -9.8828618402731], [29.99895475524692, -11.862838368999105], [30.0, -15.0], [30.0, -17.999999999999996], [30.0, -20.999999999999996], [30.248700626314843, -22.979231674036182], [30.979339504877018, -24.83540430883362], [32.14648904900943, -26.453110080186672], [33.677581553054885, -27.73176787846317], [35.47742110083785, -28.591876954844686], [37.434102386658374, -28.979959892832433], [39.425968445195934, -28.871887574991494], [41.32917469237714, -28.274379414605452], [43.025388981781916, -27.224585575103365], [45.31274753452016, -25.559144028871447], [47.26539474404002, -25.192921180034755], [49.20651581848688, -25.6160042383035], [50.82965042158696, -26.76159769152977], [51.878541289003785, -28.448837522764595], [52.18759161579067, -30.411345661695147], [51.70800915074836, -32.33928522482458], [48.60660171779821, -35.8492424049175], [46.48528137423857, -37.97056274847714], [44.36396103067892, -40.09188309203679], [42.24264068711928, -42.213203435596434], [40.12132034355963, -44.33452377915608], [37.999999999999986, -46.455844122715725], [35.87867965644034, -48.57716446627537], [34.11271750381642, -49.43472319984102], [32.194581919859296, -49.0166500153716], [29.514718625761443, -46.4558441227157], [27.3933982822018, -44.33452377915606], [25.27207793864216, -42.21320343559641], [23.150757595082517, -40.09188309203677], [22.29319886151685, -38.32592093941284], [22.71127204598626, -36.407785355455715], [24.30539922921114, -34.227544972572105], [24.865875062213835, -32.31731809966961], [24.77048449136008, -30.32885122684244], [24.02972869327501, -28.481046931755365], [22.725154590281967, -26.977322796437058], [21.000377667155846, -25.983217957503822], [19.045271901446107, -25.608169546992023], [17.07506727639741, -25.893465184490402], [15.306655949904767, -26.807697783816973], [12.899514068219995, -28.221519764244597], [10.981378484262871, -27.803446579775187], [9.732463997137101, -26.288771066715604], [9.213897555172723, -23.27947250634238], [8.259479441945983, -21.532421868700865], [6.7859697124931335, -20.19381477827191], [4.955581317102232, -19.411013278939414], [2.9698145891980423, -19.270192940608702], [1.0472748580014406, -19.7868561261652], [-0.6003929612149608, -20.904125396689345], [-1.7918035319939523, -22.49900492730442], [-2.3957991023183767, -24.39592063876009], [-2.4558441227157033, -28.24264068711929], [-2.4558441227157033, -31.24264068711929], [-2.455844122715703, -34.24264068711929], [-2.455844122715703, -37.24264068711929], [-2.4558441227157024, -40.24264068711929], [-2.4558441227157024, -43.24264068711929], [-2.4558441227157024, -46.24264068711929], [-2.8505391527012764, -48.18973239866254], [-3.9723105759798756, -49.829421141616905], [-5.6440553503323345, -50.90283611695542], [-7.601841734222146, -51.240508702326814], [-9.536578305451414, -50.7891278212477], [-13.112698372208083, -47.65685424949238], [-15.234018715767725, -45.53553390593274], [-17.355339059327367, -43.41421356237309], [-18.601452451602427, -41.85512165343948], [-19.473303683396704, -40.05972710166868], [-19.928015260024356, -38.116327104501266], [-19.94322454380197, -36.12049774190624], [-19.518183544750794, -34.170393561090485], [-18.673795706616126, -32.36192035262989], [-17.45158787907381, -30.784018520067484], [-16.06524227365197, -29.161037557087344], [-15.046055791070117, -27.44289663632445], [-14.326024873748457, -25.57948450048908], [-13.925104125064724, -23.622442890519462], [-13.840620433565944, -19.201010126776673], [-13.840620433565944, -16.201010126776673], [-13.840620433565945, -13.201010126776673], [-13.840620433565945, -10.201010126776673], [-13.840620433565945, -7.201010126776673], [-13.35095068112744, -5.283307972359861], [-12.001829657038508, -3.835126187545087], [-10.12356924023676, -3.2110301803604546], [-6.840620433565948, -3.201010126776672], [-3.840620433565948, -3.2010101267766715], [-11.499999999999996, -49.5], [-13.799999999999999, -21.5], [-2.4999999999999982, -26.2]]
        lab_time=1130

    elif number==5:
        #Race track 5 - stor bane
        yellow_points=[[3.0, 1.232595164407831e-32], [6.0, 2.465190328815662e-32], [9.0, -1.232595164407831e-32], [12.0, 4.930380657631324e-32], [15.0, 1.1093356479670479e-31], [18.0, 1.7256332301709633e-31], [21.0, 2.341930812374879e-31], [24.0, 2.9582283945787943e-31], [27.0, 3.5745259767827097e-31], [30.0, 2.2186712959340957e-31], [33.0, 8.628166150854817e-32], [34.9835796911051, 0.22130923149497264], [36.8696072717552, 0.8743529757699133], [38.56532822762763, 1.927014653007468], [39.987347291705944, 3.327524541693495], [41.065729809269605, 5.007005804679944], [41.74744111226981, 6.882861840273098], [41.99895475524692, 8.862838368999105], [42.0, 12.0], [42.0, 15.0], [42.0, 18.000000000000004], [42.0, 21.000000000000004], [42.0, 24.000000000000004], [42.0, 27.000000000000004], [42.0, 30.000000000000004], [42.0, 33.0], [41.357661782330844, 34.85510940920921], [39.705712719908966, 35.91581370408994], [36.0, 36.0], [33.0, 36.0], [29.999999999999996, 36.0], [26.999999999999996, 36.0], [23.999999999999996, 36.0], [20.999999999999996, 36.0], [19.144890590790787, 35.357661782330844], [18.084186295910058, 33.705712719908966], [18.272107719522953, 31.751559490358574], [19.62818212009256, 30.332020295360877], [23.999999999999996, 30.0], [26.999999999999996, 30.0], [28.97923167403618, 29.751299373685153], [30.83540430883362, 29.02066049512298], [32.453110080186676, 27.853510950990565], [33.731767878463174, 26.322418446945115], [34.591876954844686, 24.522578899162145], [34.97995989283243, 22.56589761334162], [34.87188757499149, 20.574031554804062], [34.27437941460545, 18.67082530762286], [33.22458557510336, 16.974611018218084], [31.787777152831644, 15.590851075624526], [30.05328793641865, 14.60558097094029], [28.12896006447893, 14.080060027196433], [23.999999999999993, 13.999999999999998], [20.999999999999993, 13.999999999999998], [17.999999999999993, 13.999999999999998], [14.999999999999993, 13.999999999999998], [11.999999999999993, 13.999999999999996], [8.999999999999993, 13.999999999999996], [5.013306692049377, 14.199334221587584], [3.1058165769134827, 14.78939005997115], [1.3535752660496403, 15.746643850903217], [-0.17356090899523496, 17.032932906528345], [-1.4147098480789728, 18.596976941318605], [-2.320390859672273, 20.376422455233268], [-2.8544972998846103, 22.300328570997596], [-3.0000000000000075, 27.000000000000004], [-3.000000000000007, 30.000000000000004], [-3.394695029985582, 32.94709171154326], [-4.516466453264179, 34.586780454497614], [-6.18821122761664, 35.660195429836136], [-8.14599761150645, 35.99786801520753], [-10.08073418273572, 35.54648713412841], [-13.512071377789638, 32.90185938653528], [-15.810204707146573, 30.97349655747566], [-18.108338036503508, 29.04513372841604], [-20.11223619061363, 26.84842575717901], [-20.64724986881464, 24.935127384213217], [-20.394956618321427, 22.964518743307742], [-19.395187995961415, 21.2477156091074], [-17.805785484287018, 20.055763447425207], [-14.622709032470473, 19.059472859722668], [-12.921609940587787, 18.017613031994692], [-11.531154146270092, 16.58728345281169], [-10.537793456244865, 14.857415087718534], [-10.00329022695356, 12.935562773175443], [-9.960877280369193, 10.941217977760292], [-10.41319164808661, 8.998379401399955], [-11.332110613470178, 7.227843336786794], [-12.66050024596403, 5.739693140966387], [-14.315767712170324, 4.626454785376505], [-16.876383656859545, 3.215245554300072], [-18.033518646031094, 1.600318646761932], [-18.470428390069824, -0.33773712524767807], [-18.11813444716599, -2.2929453693099324], [-17.032256284662854, -3.9566216948175614], [-15.38423018812436, -5.066108190897551], [-13.434243241386623, -5.446241335214348], [-11.49015550701529, -5.037006462650104], [-9.85889569165527, -3.90301276132397], [-8.036884379412694, -1.8356202850478192], [-6.373723163282023, -0.7342099209254322], [-4.4897723168177865, -0.07851240747570226], [-2.502166778885496, 0.09070415973436126], [-3.0000000000000013, 24.5], [26.0, 14.000000000000002]]
        blue_points=[[3.0, -3.0], [6.0, -3.0], [9.0, -3.0], [12.0, -3.0], [15.0, -3.0], [18.0, -3.0], [21.0, -3.0], [24.0, -3.0], [27.0, -3.0], [30.0, -3.0], [33.0, -3.0], [34.99075359232098, -2.8337187787551], [36.92633636155383, -2.3394833557768524], [38.75310646325043, -1.5309907426844724], [40.420437636836844, -0.43064712932337484], [41.882122238352444, 0.9310530710033199], [43.097651817694754, 2.5163723295823237], [44.03333975104506, 4.281375842683705], [44.66325481635975, 6.177149120364128], [44.96993983924865, 8.151153579987566], [45.0, 12.000000000000002], [45.0, 15.000000000000002], [45.0, 18.000000000000004], [45.0, 21.000000000000004], [45.0, 24.000000000000004], [45.0, 27.000000000000004], [45.0, 30.000000000000004], [45.0, 33.0], [44.669741677888425, 34.96316818077691], [43.71532356466169, 36.71021881841842], [42.24181383520884, 38.04882590884738], [40.41142543981794, 38.83162740817988], [36.0, 39.0], [33.0, 39.0], [29.999999999999996, 39.0], [26.999999999999996, 39.0], [23.999999999999996, 39.0], [20.999999999999996, 39.0], [19.03683181922308, 38.669741677888425], [17.289781181581578, 37.71532356466169], [15.95117409115262, 36.24181383520884], [15.168372591820122, 34.41142543981794], [15.027552253489409, 32.42565871191375], [15.544215439045908, 30.503118980717147], [16.66148470957005, 28.855451161500746], [18.256364240185125, 27.664040590721754], [20.153279951640798, 27.060045020397325], [24.0, 27.0], [27.0, 27.0], [28.94709171154325, 26.60530497001442], [30.586780454497614, 25.483533546735824], [31.66019542983613, 23.81178877238337], [31.997868015207523, 21.854002388493555], [31.546487134128405, 19.919265817264286], [30.377315902755747, 18.313031422293772], [28.67494075077952, 17.288888296656705], [23.999999999999993, 16.999999999999996], [20.999999999999993, 16.999999999999996], [17.999999999999993, 16.999999999999996], [14.999999999999991, 16.999999999999996], [11.999999999999991, 16.999999999999996], [8.999999999999991, 16.999999999999996], [5.027100035144522, 17.283775932216578], [3.214160506488172, 18.112095506093347], [1.7081724439728665, 19.417799533273126], [0.6312396094121255, 21.095023048752523], [0.0706784653951246, 23.00777871920562], [-7.426432906899742e-15, 27.000000000000004], [-7.166040716921782e-15, 30.000000000000004], [-0.2487006263148486, 32.979231674036185], [-0.9793395048770254, 34.835404308833624], [-2.1464890490094404, 36.453110080186676], [-3.6775815530548894, 37.731767878463174], [-5.477421100837858, 38.59187695484469], [-7.434102386658384, 38.97995989283244], [-9.425968445195943, 38.8718875749915], [-11.329174692377146, 38.274379414605455], [-13.02538898178192, 37.224585575103376], [-15.440434206849256, 35.199992715892215], [-17.738567536206194, 33.27162988683259], [-20.036700865563127, 31.343267057772973], [-22.159063053106134, 29.237738118528135], [-23.111328167167187, 27.484911494591884], [-23.60033341829408, 25.550981846076255], [-23.595674828430187, 23.556191551689913], [-23.097642046129728, 21.624567010328022], [-22.137200337613567, 19.87620728030104], [-20.77406531649342, 18.419816901579303], [-19.09299011614536, 17.345947173999562], [-17.198495850371604, 16.72136611601923], [-15.200656911862815, 15.966854225971892], [-13.780672288685684, 14.577396069064584], [-13.013860332363425, 12.744652299876716], [-13.021283790133593, 10.75797286118247], [-13.801770661241317, 8.93101075323271], [-15.232099230088513, 7.552203121619334], [-17.9825787992917, 6.16052076588491], [-19.47691731315045, 4.839096372650138], [-20.597874834727033, 3.189046598898339], [-21.275755654599333, 1.3129635476752002], [-21.468412426650094, -0.6725070235548167], [-21.163866685911103, -2.6439181711430635], [-20.381053611498192, -4.478697098307225], [-19.168644728884843, -6.0627661379635525], [-17.602021750184964, -7.297635549539926], [-15.77858970439902, -8.106527134017325], [-13.811720764484392, -8.439147930475661], [-11.823705314750077, -8.27481718881381], [-9.938148527064198, -7.623752198625287], [-8.27228518993918, -6.526433027617983], [-6.929690617199496, -5.051085667066095], [-5.478271357475239, -3.6664160598650715], [-3.6188831769629113, -2.966683329440942], [38.3, 39.0], [26.5, 17.0]]
        lab_time=1100
    elif number==6:
        #Race track 6 - Gigantium
        yellow_points=[[2.988584094275237, 0.26146722824297425], [4.973065736789846, 0.10356701968892884], [6.796651338856214, -0.6949537485288593], [8.258589460085924, -2.0461890333827735], [9.197941023496213, -3.801386602221543], [9.511296472018833, -5.7673235870255], [9.164159724102579, -7.727577637801831], [8.194745713050816, -9.466352016643265], [6.70977345377068, -10.792231820587554], [4.872717761839531, -11.559256103177265], [1.0458689129718977, -11.954336377100947], [-1.942715181303339, -12.215803605343922], [-3.734781874681503, -13.017380970605434], [-5.494274017198934, -14.567612988902503], [-7.3483832126193045, -15.292443284072696], [-9.337597204714692, -15.370722010370606], [-11.24293116836833, -14.793831767528172], [-14.73050692860734, -12.087203042094556], [-17.028640257964273, -10.15884021303494], [-18.320228376307238, -8.643947478253304], [-19.045058671477427, -6.789838282832933], [-19.123337397775337, -4.800624290737546], [-18.546447154932903, -2.895290327083908], [-15.839818429499292, 0.5922854331551008], [-14.324925694717658, 1.8838735514980642], [-12.470816499297287, 2.6087038466682566], [-10.4816025072019, 2.686982572966167], [-8.576268543548263, 2.110092330123733], [-5.234948931042194, 0.12064172858948978], [-1.8795907401064953, 0.09952080571479563], [-12.857278988938711, -13.672614124614034]]
        blue_points=[[3.2500513225182113, -2.7271168660322624], [5.1540849448087, -3.205327354418179], [6.3547297871287, -4.75854378126452], [6.337839137431882, -6.721639299054666], [5.110646002265932, -8.253966390447525], [0.7844016847289229, -8.96575228282571], [-2.2041824095463136, -9.227219511068684], [-4.131096233336463, -9.727322481491091], [-5.788315796302642, -10.830374241591711], [-7.962015576875237, -12.3558712482565], [-9.90928955474975, -12.106565489984238], [-12.802144099547723, -9.789069712737621], [-15.100277428904656, -7.860706883678005], [-16.108486635661237, -6.1762059185770015], [-15.859180877388972, -4.228931940702489], [-13.541685100142358, -1.3360773959045165], [-11.857184135041356, -0.3278681891479387], [-9.909910157166843, -0.5771739474202002], [-7.500533994880382, -2.297761515533119], [-5.59030712197789, -2.8582373485358157], [-1.8795907401064944, -2.9004791942852046]]
        lab_time=280
    else:
        print(f"The number '{number}' you entered is not valid. Please enter a number between 1 and 6")
        print("The program will break now terminated!")
    return yellow_points, blue_points, lab_time

yellow_points, blue_points, lab_time=race_track(race_track_number)

yellow_points.append([0.0,0.0])
blue_points.append([0.0,-3.0])

#yellow_points
yellow_points_np=np.array(yellow_points).reshape(-1,2)
x_yellow=yellow_points_np[:,0]
y_yellow=yellow_points_np[:,1]

#blue_points
blue_points_np=np.array(blue_points).reshape(-1,2)
x_blue=blue_points_np[:,0]
y_blue=blue_points_np[:,1]



#plot
fig_1, ax_1 = plt.subplots()
ax_1.set_aspect('equal') # Set the aspect ratio to 1
ax_1.set_xlabel('x [m]')
ax_1.set_ylabel('y [m]')
ax_1.set_title(f'Race track {race_track_number}')

ax_1.scatter(x_yellow, y_yellow, c='gold', marker='o') # Create a scatter plot object
ax_1.scatter(x_blue, y_blue, c='b', marker='o') # Create a scatter plot object
ax_1.scatter([[0,0],[0,0]],[[0,0],[0,-3]], c='darkorange', marker='o') # Create star/finish line points


def transform_points(list_of_points, x_shift, y_shift, theta):
    #list_of_points: list of points to be transformed
    #x_shift: shift in x direction
    #y_shift: shift in y direction
    #theta: rotation angle in degrees
    #returns: list of transformed points
    list_of_points_np=np.array(list_of_points).reshape(-1,2)
    x=list_of_points_np[:,0]
    y=list_of_points_np[:,1]


    #shift
    x=x-x_shift
    y=y-y_shift

    #rotate
    theta=np.deg2rad(theta)
    x_rot=x*np.cos(theta)-y*np.sin(theta)
    y_rot=x*np.sin(theta)+y*np.cos(theta)

    transform_points_np=np.array([x_rot,y_rot]).T

    return transform_points_np

#oriantation=90 #degrees
#pos=[0,0] #position of the car x,y in meters


def car_view(pos,oriantation):
    global view_depth, view_width
    yellow_points_tran=transform_points(yellow_points_np, pos[0], pos[1], oriantation)
    blue_points_tran=transform_points(blue_points_np, pos[0], pos[1], oriantation)

    #only the points that are in front of the car within in 20 meters and 5 meters to the left and right
    #view_depth=20 #meters from the car
    #view_width=10 #meters from the center of the car

    yellow_points_tran=yellow_points_tran[np.logical_and(np.logical_and(np.abs(yellow_points_tran[:,0])<view_width, yellow_points_tran[:,1]<view_depth), yellow_points_tran[:,1]>0)]
    blue_points_tran=blue_points_tran[np.logical_and(np.logical_and(np.abs(blue_points_tran[:,0])<view_width, blue_points_tran[:,1]<view_depth), blue_points_tran[:,1]>0)]
    #midpoints_tran=midpoints_tran[np.logical_and(np.logical_and(np.abs(midpoints_tran[:,0])<view_width, midpoints_tran[:,1]<view_depth), midpoints_tran[:,1]>0)]

    return yellow_points_tran, blue_points_tran#, midpoints_tran

def get_middelpoint_with_DT(yel_points, blu_points):
    #generate the point array
    point_array=[]
    for i in range(yel_points.shape[0]):
        point_array.append([yel_points[i,0],yel_points[i,1],'yellow'])

    for i in range(blu_points.shape[0]):
        point_array.append([blu_points[i,0],blu_points[i,1],'blue'])
    
    # convert the point array to a NumPy array, without color information
    point_array_without_color = DT.remove_Colors(point_array)


    # Use the filter function to remove the triangles that are made by three points of the same color
    tri = DT.delaunay_triangles_filtered(point_array, point_array_without_color)

    # Find the midpoints of the triangles that are made by two points of different color
    midpoints = DT.find_midpoints(tri, point_array)

    midpoints_np=np.array(midpoints).reshape(-1,2)
    return midpoints_np



#The car's field of view
view_depth=20 #meters from the car
view_width=10 #meters from the center of the car

#plot the car
car_pos=[0.2,0] #position of the car's back right coner x,y in meters
car_width=0.7
car_length=0.4
car_theta=90
car_speed=15 #2.5 #meters per second

def get_stering_angle(point_pos):
    global car_length
    #point_pos: position of the point the car shall be heading towards
    #returns: stering angle in degrees
    x_1=point_pos[0]
    y_1=point_pos[1]
    radius=(x_1**2+y_1**2)/(2*x_1)
    stering_angle=np.arctan(car_length/radius)
    #print(f"stering_angle={np.rad2deg(stering_angle)}, radius={radius}, x_1={x_1}, y_1={y_1}")
    return stering_angle

def update_pos_and_oriantation(pos, oriantation, stering_angle, speed, dt):
    global start_oriantation, car_length
    #pos: position of the car's back right coner x,y in meters
    #oriantation: oriantation of the car in degrees
    #stering_angle: stering angle in radians
    #speed: speed of the car in meters per second
    #dt: time step in seconds
    #returns: new position and oriantation of the car
    x=pos[0]
    y=pos[1]
    theta=np.deg2rad(oriantation)
    theta_new=theta+speed*np.tan(stering_angle)/car_length*dt
    theta=theta_new
    stering_angle=stering_angle
    x_new=x+speed*np.cos(np.deg2rad(start_oriantation)-theta)*dt
    y_new=y+speed*np.sin(np.deg2rad(start_oriantation)-theta)*dt
    theta_new=theta+speed*np.tan(stering_angle)/car_length*dt
    return [x_new, y_new], np.rad2deg(theta_new)

#plot
fig_2, ax_2 = plt.subplots()
ax_2.set_aspect('equal') # Set the aspect ratio to 1
ax_2.set_xlabel('x [m]')
ax_2.set_ylabel('y [m]')
ax_2.set_title('Car view')
lim_x=plt.xlim([-view_width-1, view_width+1]) # Set the x axis limits
lim_y=plt.ylim([-1, view_depth+1]) # Set the y axis limits

#rotat the rectangle 45 degrees
car=ax_2.add_patch(Rectangle(car_pos, car_width, car_length, edgecolor='red', facecolor='red', lw=4, angle=car_theta))


start_oriantation=90
oriantation_=start_oriantation
pos_=[0,(blue_points_np[1,1]-yellow_points_np[1,1])/2]
dt=0.1#dt=0.03 #time step in seconds
stering_angle=0 #degrees
diff_angle=0
num_midtpoints_too_close=0
number_of_midpoints=4
pause=True
integral_error=0
counter=0
route_taken=[]

for i in range(1100):
    #run if key 'q' is not pressed
    if keyboard.is_pressed('z'):
        print("The key 'z' was pressed and the program is now terminated!")
        #close all figures
        plt.close('all')
        break
    plt.xlim([-view_width-1, view_width+1]) # Set the x axis limits
    plt.ylim([-1, view_depth+1]) # Set the y axis limits


    pos_,oriantation_=update_pos_and_oriantation(pos_,oriantation_,stering_angle,car_speed,dt)

    #print(f"pos_={pos_}, oriantation_={oriantation_}")

    #pos_=[pos_[0]+np.cos(np.deg2rad(90-oriantation_))*1, pos_[1]+np.sin(np.deg2rad(90-oriantation_))*1]
    
    #transformed points
    yellow_points_tran, blue_points_tran=car_view(pos_,oriantation_)
    midpoints=get_middelpoint_with_DT(yellow_points_tran[0:,:], blue_points_tran[0:,:])
    midpoints=midpoints[num_midtpoints_too_close:]
    if (midpoints[0,0]**2+midpoints[0,1]**2)<(1.2**2):
        mid_points_next=midpoints[1:number_of_midpoints+1,:]
    else:
        mid_points_next=midpoints[:number_of_midpoints,:]
    #mid_points_next=midpoints[:number_of_midpoints,:]
    """
    j=0
    k=0
    for i in range(number_of_midpoints):
        j=i
        while True:
            k+=1
            if midpoints[i,0]<abs(midpoints[i,1]):
                mid_points_next[i,:]=midpoints[i,:]
                j=1
            if k>number_of_midpoints*1.5:
                break
            j+=1
    """
    angles_x=[]
    
    gain=3/5
    sum_gain=0
    for i in range(len(mid_points_next)):
        
        angles_x.append(get_stering_angle(mid_points_next[i,:])*gain)
        sum_gain+=gain
        if gain==3/5:
            gain=2/5
        if i<(len(mid_points_next)-2):
            gain=gain/2
    
        
        """
        for j in range(gain):
            angles_x.append(get_stering_angle(mid_points_next[i,:]))
        gain-=1
    #angles_x[:]=get_stering_angle(mid_points_next[:,:])
    stering_angle=np.mean(angles_x)"""
    stering_angle_new=np.sum(angles_x)
    if stering_angle_new>np.deg2rad(25):
        stering_angle_new=np.deg2rad(25)
    if stering_angle_new<np.deg2rad(-25):
        stering_angle_new=np.deg2rad(-25)

    #PID
    #kp=0.05
    #ki=0.010
    #kd=0.005
    kp=0.4
    ki=0.001
    kd=0.001
    angle_diff=stering_angle_new-stering_angle
    integral_error+=angle_diff
    stering_angle=angle_diff*kp+integral_error*ki+(diff_angle-stering_angle)*kd
    #stering_angle+=(stering_angle_new-stering_angle)
    #stering_angle=stering_angle_new*0.05
    #print(f"angles_x={angles_x}, sum={np.sum(angles_x)}, sum gain={sum_gain}")
    #print(f"stering_angle={stering_angle}")
 
    ax_2.add_patch(Rectangle(car_pos, car_width, car_length, edgecolor='red', facecolor='red', lw=4, angle=car_theta))

    if counter%int(1/dt)==0:
        ax_1.scatter(pos_[0],pos_[1],c='r', marker='.')
    counter+=1
    route_taken.append(pos_)


    ax_2.scatter(yellow_points_tran[:,0], yellow_points_tran[:,1], c='gold', marker='o') # Create a scatter plot object
    ax_2.scatter(blue_points_tran[:,0], blue_points_tran[:,1], c='b', marker='o') # Create a scatter plot object
    ax_2.scatter(midpoints[:,0], midpoints[:,1], c='r', marker='o') # Create a scatter plot object
    
    if keyboard.is_pressed('p'):
        pause=True
        plt.pause(0.1)

    #pause the program if key 'p' is pressed
    if pause==True:
        print("The program is now paused until the key 'p' is pressed!")
        while True:
            if keyboard.is_pressed('p'):
                print("The key 'p' was pressed and the program is now continuing!")
                break
            else:
                plt.pause(0.1)
        pause=False
    
    plt.pause(dt)
    #plt.pause(8)
    ax_2.clear()

#show route taken in the end
route_taken_np=np.array(route_taken).reshape(-1,2)
ax_1.scatter(route_taken_np[:,0], route_taken_np[:,1], c='r', marker='.')
plt.show()




